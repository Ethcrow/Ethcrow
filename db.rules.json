{
  "rules": {
    "handshake": {
      "$uid": {
        ".read": "auth !== null && $uid === auth.uid",
        ".write": "auth !== null && root.child('connected').hasChild($uid)",
        ".validate": "newData.hasChild('sender') && newData.hasChild('stage') && newData.child('sender').val() == auth.uid && (( newData.child('stage').val() === 'EXCHANGE' && newData.hasChildren(['wrapedKey', 'iv'])) || (newData.child('stage').val() === 'SIGNAL' && newData.hasChildren(['signal'])))"
      }
    },
    "connected": {
      "$uid": {
        ".read": "auth !== null",
        ".write": "auth !== null && auth.uid === $uid",
        ".validate": "newData.isBoolean()"
      }
    },
    "subscribers": {
      ".read": true,
      ".write": true
    }
  }
}
